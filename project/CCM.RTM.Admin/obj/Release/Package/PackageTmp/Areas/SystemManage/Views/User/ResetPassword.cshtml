@{
    ViewBag.Title = "Form";
    Layout = "~/Views/Shared/_Form.cshtml";
}
<script>
    var keyValue = $.request("keyValue");
    $(function () {
        $("#F_Account").val($.request('account'));
        $("#F_RealName").val($.request('realName'));
    });

    function submitForm() {
        if ($("#F_UserPassword").val() != $("#F_UserPassword2").val()) {
            msg = "請確認密碼是否相同!";
            window.setTimeout(function () {
                $.modalMsg(msg, "warning");
            }, 500);
            return false;
        }
        if (!$('#form1').formValid()) {
            return false;
        }
        var postData = $("#form1").formSerialize();
        postData["userPassword"] = $("#F_UserPassword").val();
        postData["keyValue"] = $("#F_Account").val();
        //postData["keyValue"] = keyValue;
        //$.submitForm({
        //    url: "/SystemManage/User/SubmitResetPassword",
        //    param: postData,
        //    success: function () {
        //        $.loading(false)
        //    }
        //})

        $.modalConfirm("注：您確定要變更密碼嗎？", function (r) {
            if (r) {
                $.loading(true, '處理中，請稍候...');
                window.setTimeout(function () {
                    $.ajax({
                        url: "/SystemManage/User/SubmitResetPassword",
                        data: { keyValue: postData["keyValue"], userPassword: postData["userPassword"] },
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            $.loading(false);
                            msg = "變更成功!";
                            $.modalMsg(msg, 'success');
                            $.modalClose();
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            $.loading(false);
                            $.modalMsg(errorThrown, "error");
                        },
                        beforeSend: function () {
                            $.loading(true, '處理中，請稍候...');
                        },
                        complete: function () {
                            $.loading(false);
                        }
                    });
                }, 500);
            }
        });
    }
</script>
<form id="form1">
    <div style="padding-top: 10px; margin-right: 40px;">
        <table class="form">
            <tr>
                <th class="formTitle">帳戶</th>
                <td class="formValue">
                    <input id="F_Account" name="F_Account" readonly type="text" class="form-control" disabled="disabled" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">姓名</th>
                <td class="formValue">
                    <input id="F_RealName" name="F_RealName" readonly type="text" class="form-control" disabled="disabled" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">新密碼</th>
                <td class="formValue">
                    <input id="F_UserPassword" name="F_UserPassword" type="password" class="form-control required" placeholder="請輸入新密碼" />
                </td>
            </tr>
            <tr>
                <th class="formTitle">確認新密碼</th>
                <td class="formValue">
                    <input id="F_UserPassword2" name="F_UserPassword" type="password" class="form-control required" placeholder="請再輸入新密碼" />
                </td>
            </tr>
            <tr>
                <th colspan="2"><br /><div style="text-align:center;color:red">注意:下次登入須使用新密碼。</div></th>
            </tr>
        </table>
    </div>
</form>

