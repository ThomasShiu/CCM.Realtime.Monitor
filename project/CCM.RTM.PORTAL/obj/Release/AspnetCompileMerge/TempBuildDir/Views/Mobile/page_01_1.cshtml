
@{
    ViewBag.Title = "通訊錄查詢";
    Layout = "~/Views/Shared/_LayoutMobile.cshtml";
}

<div class="panel panel-primary" id="panel-search">
    <div class="panel-heading">查詢條件</div>
    <div class="panel-body">
        <form id="formSearch" class="form-horizontal">
            <div class="form-group" style="margin-top:5px">
                <div class="row">
                    <div class="col-sm-7">

                        <div class="input-group">
                            <input id="txt_keyword" type="text" class="form-control" placeholder="說明" style="width: 100px;">
                            <span class="input-group-btn">
                                <button id="btn_search" type="button" class="btn  btn-info"><i class="fa fa-search"></i></button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

        </form>
    </div>
</div>

<div id="toolbar" class="btn-group">
    @*<button id="btn_add" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
        </button>
        <button id="btn_edit" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
        </button>
        <button id="btn_delete" type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>刪除
        </button>*@

    <a class="btn btn-primary" data-toggle="tooltip" data-placement="bottom" title="回上一頁"
       href="javascript:void(0);" onclick="history.go(-1);" role="button">
        <i class="glyphicon glyphicon-level-up" aria-hidden="true">上一頁</i>
    </a>
    <button id="btn_detail" type="button" class="btn btn-default">
        <span class="glyphicon glyphicon-search" aria-hidden="true"></span>檢視
    </button>
    @*<select class="form-control col-lg-1">
            <option value="">Export Basic</option>
            <option value="all">Export All</option>
            <option value="selected">Export Selected</option>
        </select>*@
</div>
<table id="tb_bootstraptable"></table>

@section scripts{
    @*bootstrap table組件以及中文包的引用*@
    <link href="~/Content/js/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />
    <script src="~/Content/js/bootstrap-table/locale/bootstrap-table-zh-TW.min.js"></script>
    <script src="~/Content/js/bootstrap-table/extensions/export/bootstrap-table-export.min.js"></script>
    <script src="~/Content/js/bootstrap-table/extensions/export/tableExport.js"></script>



    <script type="text/javascript">
     // 應用程式目錄
     var vhost = '@Request.Url.Host';
     if (vhost == 'localhost') {
         var vroot = '@Request.ApplicationPath.Replace("/","")';
     } else {
         var vroot = '@Request.ApplicationPath';
     }
        var vArea = '@ViewContext.RouteData.DataTokens["area"]';   //若沒使用則為null
        var vController = '@ViewContext.RouteData.Values["controller"]';
        var vAction = '@ViewContext.RouteData.Values["action"]';

        // 詳細內容的對話視窗
        $(document).ready(function () {
            $('#showDetails').click(function () {
                var url = $('#detailsModal').data('url');

                $.get(url, function (data) {
                    $('#detailsContainer').html(data);

                    $('#detailsModal').modal('show');
                });
            });
        });

        // 匯出功能項目,下拉選項
        //var $table = $('#tb_bootstraptable');
        //$(function () {
        //    $('#toolbar').find('select').change(function () {
        //        $table.bootstrapTable('destroy').bootstrapTable({
        //            exportDataType: $(this).val()
        //        });
        //    });
        //})

        // bootstrap-table 自動高度
        function getHeight() {
            return $(window).height() - $('#navbar').outerHeight(true) - $('#formSearch').outerHeight(true) - $('#toolbar').outerHeight(true) - 150;
        }

        $(function () {
            var vProject = location.host;

            //toastr.options.positionClass = 'toast-top-center';
            //1.初始化Table
            var oTable = new TableInit();
            oTable.Init();

            //2.初始化Button的點擊事件
            var oButtonInit = new ButtonInit();
            oButtonInit.Init();

        });



        var TableInit = function () {
            var oTableInit = new Object();

            oTableInit.Init = function () {
                $('#tb_bootstraptable').bootstrapTable({
                    url: '/Mobile/GetEmpContact',         //請求後臺的URL（*）
                    method: 'get',                      //請求方式（*）
                    toolbar: '#toolbar',                //工具按鈕用哪個容器
                    striped: true,                      //是否顯示行間隔色
                    cache: false,                       //是否使用緩存，默認為true，所以一般情況下需要設置一下這個屬性（*）
                    pagination: true,                   //是否顯示分頁（*）
                    sortable: true,                     //是否啟用排序
                    sortOrder: "desc",                   //排序方式
                    queryParams: oTableInit.queryParams,//傳遞參數（*）
                    sidePagination: "client",           //分頁方式：client用戶端分頁，server服務端分頁（*）
                    pageNumber: 1,                       //初始化載入第一頁，默認第一頁
                    pageSize: 10,                       //每頁的記錄行數（*）
                    pageList: [10, 25, 50, 100],        //可供選擇的每頁的行數（*）
                    search: true,                       //是否顯示表格搜索，此搜索是用戶端搜索，不會進服務端，所以，個人感覺意義不大
                    strictSearch: true,
                    showColumns: true,                  //是否顯示所有的列
                    showRefresh: true,                  //是否顯示刷新按鈕
                    minimumCountColumns: 2,             //最少允許的列數
                    clickToSelect: true,                //是否啟用點擊選中行
                    height: getHeight(),                //行高，如果沒有設置height屬性，表格自動根據記錄條數覺得表格高度
                    uniqueId: "ID",                     //每一行的唯一標識，一般為主鍵列
                    showToggle: true,                    //是否顯示詳細視圖和清單視圖的切換按鈕
                    cardView: false,                    //是否顯示詳細視圖
                    detailView: false,                   //是否顯示父子表
                    showExport: true,
                    exportDataType: 'all',
                    singleSelect: true,
                    columns: [{
                        checkbox: true
                        //radio : true
                    }, {
                        field: 'EMPLYID',
                        title: '工號'
                    }, {
                        field: 'EMPLYNM',
                        title: '姓名'
                    }, {
                        field: 'BRTHDT',
                        title: '生日'
                    }, {
                        field: 'HP',
                        title: '手機'
                    }, {
                        field: 'CONTEL',
                        title: '電話'
                    }]
                });
            };

            //得到查詢的參數
            oTableInit.queryParams = function (params) {
                var temp = {   //這裡的鍵的名字和控制器的變數名必須一直，這邊改動，控制器也需要改成一樣的
                    limit: params.limit,   //頁面大小
                    offset: params.offset,  //頁碼
                    sdate: $("#txt_search_startdate").val(),
                    edate: $("#txt_search_enddate").val(),
                    ordno: $("#txt_search_ordno").val(),
                    keyword: $("#txt_search_keyword").val(),
                    order: params.order,
                    ordername: params.sort,
                    statu: $("#txt_search_statu").val(),
                    search: params.search
                };
                return temp;
            };
            return oTableInit;
        };


        var ButtonInit = function () {
            var oInit = new Object();
            var postdata = {};

            oInit.Init = function () {
                //$("#btn_add").click(function () {
                //    $("#myModalLabel").text("新增");
                //    $("#myModal").find(".form-control").val("");
                //    $('#myModal').modal()

                //    postdata.DEPARTMENT_ID = "";
                //});
                $("#btn_edit").click(function () {
                    var arrselections = $("#tb_bootstraptable").bootstrapTable('getSelections');
                    if (arrselections.length > 1) {
                        toastr.warning('只能選擇一筆進行編輯');

                        return;
                    }
                    if (arrselections.length <= 0) {
                        toastr.warning('請選擇有效資料');

                        return;
                    }
                    //alert(arrselections[0].ORD_NO);
                    toastr.info(arrselections[0].ORD_NO);
                });

                $("#btn_detail").click(function () {
                    var arrselections = $("#tb_bootstraptable").bootstrapTable('getSelections');
                    if (arrselections.length > 1) {
                        toastr.warning('只能選擇一筆進行檢視');

                        return;
                    }
                    if (arrselections.length <= 0) {
                        toastr.warning('請選擇有效資料');

                        return;
                    }
                    var url = "Details/";
                    //window.location.href = url + arrselections[0].ID;
                    toastr.info("單號:" + arrselections[0].ORD_NO);

                    var url = $('#detailsModal').data('url');
                    url = url + '/' + arrselections[0].ID;
                    $.get(url, function (data) {
                        $(".modal-header .titlestr").text('檢視-' + arrselections[0].ORD_NO);
                        $('#detailsContainer').html(data);
                        $('#detailsModal').modal('show');
                    });

                });
               

                $("#btn_query").click(function () {
                    $("#tb_bootstraptable").bootstrapTable('refresh');
                });
            };

            return oInit;
        };
    </script>

}